<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sensecloud.web.mapper.UserRoleMapper">

    <select id="listUserRoleProductVOPage" resultType="sensecloud.web.bean.vo.UserRoleProductVO">
        SELECT ur.id, ur.user_id, u.name username, ur.role_id, r.name role_name, p.id product_id, p.name, product_name
        FROM user_role ur
        JOIN user u ON ur.user_id = u.id
        JOIN role r ON ur.role_id = r.id
        JOIN user_product up ON ur.user_id = us.user_id
        JOIN product p ON up.product_id = p.id
        <where>
            <if test="query.productName!=null">
                AND s.product_name = #{query.productName}
            </if>
            <if test="query.username!=null">
                AND u.name = #{query.username}
            </if>
        </where>
        ORDER BY u.name DESC
    </select>

</mapper>
